class GoalConsoleView{constructor(app){this.app=app}async render(){const g=await this.app.api.getGoals({});const goals=g.goals||[];const v=document.getElementById('view');v.innerHTML=`<div class='card'><h3>Submit Goal</h3><textarea id='goal-text' class='input' placeholder='What would you like me to do?'></textarea><select id='goal-priority'><option value='30'>Low</option><option value='50' selected>Medium</option><option value='70'>High</option><option value='90'>Critical</option></select><button class='btn primary' id='goal-submit'>Submit</button></div><div class='card'><h3>Goals</h3>${UIComponents.table(['Goal','Status','Priority','When','Actions'],goals.map(x=>[x.goal,UIComponents.badge(x.status,x.status==='completed'?'healthy':x.status==='failed'?'unhealthy':'degraded'),x.priority,Utils.timeAgo(x.submitted_at),`<button class='btn' data-view='${x.record_id}'>View</button> <button class='btn danger' data-cancel='${x.record_id}'>Cancel</button>`]))}</div>`;document.getElementById('goal-submit').onclick=()=>this.submitGoal(document.getElementById('goal-text').value,Number(document.getElementById('goal-priority').value));v.querySelectorAll('[data-view]').forEach(b=>b.onclick=()=>this.viewGoalDetail(b.dataset.view));v.querySelectorAll('[data-cancel]').forEach(b=>b.onclick=()=>this.cancelGoal(b.dataset.cancel))}async submitGoal(t,p){if(!t)return;await this.app.api.submitGoal(t,p);UIComponents.toast('Goal submitted');this.render()}async refreshGoals(){this.render()}async viewGoalDetail(id){const d=await this.app.api.getGoal(id);UIComponents.modal('Goal Detail',UIComponents.codeBlock(JSON.stringify(d,null,2)))}async cancelGoal(id){await this.app.api.cancelGoal(id);UIComponents.toast('Goal cancelled');this.render()}};window.GoalConsoleView=GoalConsoleView;
