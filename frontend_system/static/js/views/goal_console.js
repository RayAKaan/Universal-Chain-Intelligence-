class GoalConsoleView{constructor(app){this.app=app}async mount(){const data=await this.app.api.getGoals({});const goals=data.goals||[];this.app.view.innerHTML=`<section class='card'><div class='card-header'><div class='card-title'>Mission Briefing</div></div><div class='card-body'><textarea id='goal-input' rows='3' placeholder='Describe your objective...'></textarea><div style='display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px'><button class='btn chip psel' data-p='30'>Routine</button><button class='btn chip psel active' data-p='50'>Standard</button><button class='btn chip psel' data-p='70'>Priority</button><button class='btn chip psel' data-p='90'>Critical</button></div><button class='btn btn-primary' id='goal-submit' style='width:100%;margin-top:10px'>INITIATE</button></div></section><section class='card' style='margin-top:14px'><div class='card-header'><div class='card-title'>Goals</div></div><div class='card-body'>${UIComponents.table(['Goal','Status','Priority','When','Actions'],goals.map(g=>[g.goal,UIComponents.statusBadge(g.status),g.priority,Utils.timeAgo(g.submitted_at),`<button class='btn' data-view='${g.record_id}'>View</button> <button class='btn btn-danger' data-cancel='${g.record_id}'>Cancel</button>`]))}</div></section>`;let p=50;this.app.view.querySelectorAll('.psel').forEach(x=>x.onclick=()=>{p=Number(x.dataset.p);this.app.view.querySelectorAll('.psel').forEach(y=>y.classList.remove('active'));x.classList.add('active')});document.getElementById('goal-submit').onclick=async()=>{const t=document.getElementById('goal-input').value.trim();if(!t)return;await this.app.api.submitGoal(t,p);UIComponents.toast('Goal initiated');this.mount()};this.app.view.querySelectorAll('[data-view]').forEach(b=>b.onclick=async()=>{const d=await this.app.api.getGoal(b.dataset.view);UIComponents.modal('Goal Detail',`<div class='terminal'>${JSON.stringify(d,null,2)}</div>`)});this.app.view.querySelectorAll('[data-cancel]').forEach(b=>b.onclick=async()=>{await this.app.api.cancelGoal(b.dataset.cancel);UIComponents.toast('Goal cancelled');this.mount()})}} window.GoalConsoleView=GoalConsoleView;
